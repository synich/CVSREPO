head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2022.10.07.16.11.54;	author u0_a111;	state Exp;
branches;
next	1.2;
commitid	10063404FCA37244B29;

1.2
date	2022.09.30.14.13.14;	author u0_a111;	state Exp;
branches;
next	1.1;
commitid	1006336F97A767E92AA;

1.1
date	2022.09.29.16.12.00;	author u0_a111;	state Exp;
branches;
next	;
commitid	1006335C3D00A0DEA03;


desc
@@


1.3
log
@lua format string function
@
text
@-- tmrec.cgi/read?dt=2208
function read(q)
  local dt = q["dt"]
  local belong = dt:sub(1,1)
  local mon = dt:sub(1,4)
  local day = dt:sub(5,6)
  local cmd = "sed -n -e '"..day.."p' ../Archive/t"..belong.."/"..mon..".txt"
  if day == '' then
    local cmd = "cat ../Archive/t"..belong.."/"..mon..".txt"
  end
  os.execute(cmd)
end

function edit(q, c)
  local dt = q["dt"]
  local belong = dt:sub(1,1)
  local mon = dt:sub(1,4)
  local day = dt:sub(5,6)
  local txt = b64dec(c["txt"])
  local tm_name = format(" ../Archive/t$/$.txt ", "$", belong, mon)
  local cmd = "sed -e '"..day.."c \\\n"..dt..txt.."'"..tm_name.." >tmp_tmrec"
  print(cmd)
  os.execute(cmd)
  os.execute("mv tmp_tmrec "..tm_name)
end

fn["read"]=read
fn["edit"]=edit
--read({dt="2209"})


@


1.2
log
@restore urlencode in entry
@
text
@d20 1
a20 1
  local tm_name = " ../Archive/t"..belong.."/"..mon..".txt "
@


1.1
log
@lua cgi-bin
@
text
@d19 1
a19 1
  local txt = b64dec(res_urlenc(c["txt"]))
a30 1
main()
@

