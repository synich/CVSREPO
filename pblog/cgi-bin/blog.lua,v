head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2022.10.03.09.42.04;	author u0_a111;	state Exp;
branches;
next	1.2;
commitid	100633AAE6C319048A0;

1.2
date	2022.10.02.14.21.38;	author u0_a111;	state Exp;
branches;
next	1.1;
commitid	10063399E721FE59B39;

1.1
date	2022.09.29.16.12.00;	author u0_a111;	state Exp;
branches;
next	;
commitid	1006335C3D00A0DEA03;


desc
@@


1.3
log
@edit blog
@
text
@-- blog.cgi/read?dt=220204
function read(q)
  local dt = q["dt"]
  local belong = dt:sub(1,1)
  local fd = io.open("../Archive/b"..belong.."/"..dt..".md", "r")
  if fd then
    local txt = fd:read("*a")
    print(txt)
  end
end

function keyword(q)
  local kwd = b64dec(q["kwd"])
  os.execute("grep '"..kwd.."' ../Archive/b*/*.md")
end

function edit(q, c)
  local dt = q["dt"]
  local belong = dt:sub(1,1)
  print()
  local ctx = b64dec(c["ctx"])
  local fd = io.open("../Archive/b"..belong.."/"..dt..".md", "w")
  fd:write(ctx)
  fd:close()
  print("len:"..#ctx)
end

function title(q)
  local p = tonumber(q["page"])
  local s,e = p*50+1, p*50+50
  local cmd = "cat ../Archive/blog_title | sed -ne '"..tostring(s)..","..tostring(e).."p'"
  os.execute(cmd)
end

fn["read"]=read
fn["keyword"]=keyword
fn["edit"]=edit
fn["title"]=title
--read({dt="220115"})

@


1.2
log
@blog show recent
@
text
@d17 11
d37 1
@


1.1
log
@lua cgi-bin
@
text
@d4 2
a5 1
  local fd = io.open("../Archive/"..dt..".md", "r")
d14 8
a21 1
  os.execute("grep '"..kwd.."' ../Archive/*.md")
d26 1
@

