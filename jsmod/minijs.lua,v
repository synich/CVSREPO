head	1.5;
access;
symbols;
locks; strict;
comment	@# @;


1.5
date	2025.09.22.12.51.23;	author u0_a108;	state Exp;
branches;
next	1.4;
commitid	10068D1464B608EDEFD;

1.4
date	2025.09.22.09.44.09;	author u0_a108;	state Exp;
branches;
next	1.3;
commitid	10068D11A695B08A657;

1.3
date	2025.02.21.16.01.45;	author u0_a157;	state Exp;
branches;
next	1.2;
commitid	10067B8A3693AAB588C;

1.2
date	2025.01.10.15.59.42;	author shuw;	state Exp;
branches;
next	1.1;

1.1
date	2025.01.01.15.49.31;	author u0_a157;	state Exp;
branches;
next	;
commitid	1006775640B739819FF;


desc
@@


1.5
log
@fix: rewrite minify
@
text
@local function _js(fout, li)
  li = li:gsub("//.*", "")
  li = li:gsub("^[ \t]+", "")
  fout:write(li)
end

local function _css(fout, li)
  if li:find("/%*%-") or 0==li:len() then
  else
    li = li:gsub("^[ \t]+", "")
    fout:write(li)
  end
end

local function minify(fname, post, fn)
  local fin = io.open(fname, "r")
  local oname = fname:gsub(post.."$", ".min"..post)
  local fout = io.open(oname, "w")
  for li in fin:lines() do
    fn(fout, li)
  end
  fin:close()
  fout:close()
end

local function main()
  if arg then
    if arg[1]:find("%.js") then
      minify(arg[1], ".js", _js)
    else
      minify(arg[1], ".css", _css)
    end
  else
    local t = formdata(); pprint(t)
  end
end

main()
@


1.4
log
@feat: mini css
@
text
@d1 9
a9 6
function minijs(fname)
  local fin = io.open(fname, "r")
  local oname = fname:gsub(".js$", ".min.js")
  local fout = io.open(oname, "w")
  for li in fin:lines() do
    li = li:gsub("//.*", "")
a12 2
  fin:close()
  fout:close()
d15 1
a15 1
function minicss(fname)
d17 1
a17 1
  local oname = fname:gsub(".css$", ".min.css")
d20 1
a20 5
    if li:find("/%*%-") or 0==li:len() then
    else
      li = li:gsub("^[ \t]+", "")
      fout:write(li)
    end
d26 1
a26 1
function main()
d29 1
a29 1
      minijs(arg[1])
d31 1
a31 1
      minicss(arg[1])
@


1.3
log
@feat: unit test with sep.js
@
text
@d14 15
d31 5
a35 1
    minijs(arg[1])
@


1.2
log
@fix: minijs can deal tab
@
text
@d14 9
a22 1
minijs("sep.js")
@


1.1
log
@feat: minijs appear
@
text
@d1 14
a14 14
function minijs(fname)
  local fin = io.open(fname, "r")
  local oname = fname:gsub(".js$", ".min.js")
  local fout = io.open(oname, "w")
  for li in fin:lines() do
    li = li:gsub("//.*", "")
    li = li:gsub("^ +", "")
    fout:write(li)
  end
  fin:close()
  fout:close()
end

minijs("sep.js")
@

